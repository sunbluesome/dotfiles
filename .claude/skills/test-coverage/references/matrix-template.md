# テストマトリクステンプレート

## 完全テンプレート

```markdown
# テスト網羅性レポート

**生成日時**: YYYY-MM-DD HH:MM
**対象ブランチ**: {branch-name}
**対象機能**: {機能名}

---

## 1. サマリー

| 項目 | 値 |
|------|-----|
| 対象コード | `{ファイルパス}` |
| テストファイル | `{テストファイルパス}` |
| テストケース数 | {実装済み}/{必要数} |
| カバー率 | {X}% |
| 未カバー重要項目 | {Critical: N件, Important: M件} |

### ステータス凡例

| 記号 | 意味 |
|------|------|
| ✓ | テスト実装済み |
| ✗ | テスト未実装 |
| ○ | 対象外（理由付き） |
| ? | 要確認 |

---

## 2. カテゴリ別チェックリスト

### 正常系 (Happy Path)

- [ ] 基本的な入力で正しく動作する
- [ ] 複数データで正しく動作する
- [ ] オプショナルパラメータのデフォルト動作

### 境界値・エッジケース

- [ ] 空データ (n=0)
- [ ] 単一データ (n=1)
- [ ] 最大値付近
- [ ] null/None値
- [ ] inf/-inf値
- [ ] nan値
- [ ] 0値
- [ ] 負値

### 異常系

- [ ] 不正な型入力
- [ ] 範囲外の値
- [ ] 不整合データ

### ビジネスロジック固有

- [ ] {ドメイン固有ルール1}
- [ ] {ドメイン固有ルール2}
- [ ] 計算精度

### データフロー

- [ ] 入出力DTOの整合性
- [ ] 必須カラムの存在確認
- [ ] 型維持の確認

---

## 3. テストマトリクス

### 3.1 入力パターン

| # | 入力カテゴリ | 具体的な値 | 備考 |
|---|-------------|-----------|------|
| I1 | 正常値 | `[10, 20, 30]` | 典型的なケース |
| I2 | 空データ | `[]` | 境界ケース |
| I3 | 単一データ | `[10]` | 集計の特殊ケース |
| I4 | null含む | `[10, null, 30]` | 欠損値 |
| I5 | 負値含む | `[-10, 20, 30]` | 無効値 |

### 3.2 条件パターン

| # | 条件カテゴリ | 条件式 | 備考 |
|---|------------|--------|------|
| C1 | 基本条件 | なし | デフォルト |
| C2 | フィルタ有効 | `filter=True` | オプション |
| C3 | 閾値指定 | `threshold=0.2` | パラメータ |

### 3.3 マトリクス本体

| # | 入力 | 条件 | 期待結果 | 優先度 | カバー |
|---|------|------|----------|--------|--------|
| 1 | I1 | C1 | 正常終了、結果=X | Critical | ✓ |
| 2 | I2 | C1 | 空結果またはNaN | Critical | ✓ |
| 3 | I3 | C1 | 単一値=入力値 | High | ✗ |
| 4 | I4 | C1 | null除外後計算 | Critical | ✗ |
| 5 | I5 | C1 | 負値除外後計算 | High | ✓ |
| 6 | I1 | C2 | フィルタ適用結果 | Medium | ✓ |
| 7 | I1 | C3 | 閾値適用結果 | Medium | ○ |

---

## 4. 未カバー項目の詳細

### Critical（必須対応）

#### TC-3: 単一データケース

**概要**: 単一データ（n=1）での集計処理

**入力**:
```python
data = [10]
```

**期待結果**:
- 平均: 10
- 中央値: 10
- 標準偏差: NaN（または0）

**リスク**: 集計処理でn=1は特殊ケースであり、除算エラーや不正な結果の原因になりやすい

**追加先**: `test_{機能名}.py::test_single_data`

---

#### TC-4: null値ハンドリング

**概要**: null値を含むデータの処理

**入力**:
```python
data = [10, None, 30]
```

**期待結果**:
- null値が除外される
- 残りのデータで計算される

**リスク**: 実データには必ずnullが含まれる。未処理だとTypeError発生

**追加先**: `test_{機能名}.py::test_null_handling`

---

### Important（推奨対応）

#### TC-X: {未カバー項目}

**概要**: {説明}

**リスク**: {なぜテストが必要か}

**追加先**: `{テストファイル}::{テスト関数名}`

---

## 5. 対象外項目（スキップ理由）

| # | 項目 | スキップ理由 |
|---|------|-------------|
| TC-7 | 閾値適用結果 | 現バージョンでは閾値機能未実装 |

---

## 6. テスト実装ガイド

### Featureファイル追加例

```gherkin
# tests/features/processor/{機能名}.feature に追加

Scenario: 単一データでの計算
  Given 単一のデータがある
    | value |
    | 10    |
  When 計算を実行する
  Then 結果が10である

Scenario: null値を含むデータでの計算
  Given null値を含むデータがある
  When 計算を実行する
  Then null値が除外されて計算される
```

### Step Definition追加例

```python
# tests/src/processor/test_{機能名}.py に追加

@given("単一のデータがある", target_fixture="context")
def step_given_single_data(context: Context, datatable: list[list[str]]) -> Context:
    # 実装
    return context

@then("結果が10である")
def step_then_result_is_10(context: Context) -> None:
    assert context.result == 10
```

---

## 7. 確認チェックリスト

レビュー時に確認:

- [ ] Critical項目が全てカバーされている
- [ ] Important項目の大半がカバーされている
- [ ] 対象外項目に妥当な理由がある
- [ ] テストが実際に機能をテストしている（形式的でない）
- [ ] 期待結果が明確に定義されている
```

---

## 簡易テンプレート（クイック版）

```markdown
# テスト網羅性チェック: {機能名}

## 対象
- コード: `{ファイルパス}`
- テスト: `{テストファイルパス}`

## チェックリスト

### 必須（Critical）
- [ ] 正常系の基本動作
- [ ] 空データ (n=0)
- [ ] null/None値

### 重要（High）
- [ ] 複数データ
- [ ] 単一データ (n=1)
- [ ] 境界値（0, 負値, inf）

### 推奨（Medium）
- [ ] 異常系（型エラー）
- [ ] ビジネスロジック固有
- [ ] データフロー整合性

## 未カバー項目
1. {項目}: {理由と対応案}
```

---

## コンポーネント別テンプレート

### Processor用

```markdown
## Processorテストマトリクス: {Processor名}

### 入力DTO
- 型: `{入力DTO名}`
- 必須フィールド: {フィールド一覧}

### 出力DTO
- 型: `{出力DTO名}`
- 必須フィールド: {フィールド一覧}

### テストケース

| # | 入力パターン | 期待出力 | カバー |
|---|-------------|----------|--------|
| 1 | 正常DTO | 正常変換 | ✓ |
| 2 | 空DTO | 空結果/エラー | ✓ |
| 3 | null含むDTO | null除外/エラー | ✗ |
```

### Calculator用

```markdown
## Calculatorテストマトリクス: {Calculator名}

### 計算式
`{数式}`

### 数値テストケース

| # | 入力値 | 期待結果 | 検証方法 | カバー |
|---|--------|----------|----------|--------|
| 1 | [10,20,30] | 0.05 | pytest.approx(rel=0.01) | ✓ |
| 2 | [] | NaN | math.isnan() | ✓ |
| 3 | [0,0,0] | 0 or NaN | 実装依存 | ✗ |
```

### Pipeline用

```markdown
## Pipelineテストマトリクス: {Pipeline名}

### 処理ステップ
1. {ステップ1}
2. {ステップ2}
3. {ステップ3}

### E2Eテストケース

| # | 入力 | 経由ステップ | 期待出力 | カバー |
|---|------|-------------|----------|--------|
| 1 | 正常データ | 全ステップ | 正常結果 | ✓ |
| 2 | 空データ | ステップ1で終了 | エラー | ✓ |
```
